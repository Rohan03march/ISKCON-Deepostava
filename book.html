<!DOCTYPE html>
<html>
<head>
    <title>Krishna Book</title>
    <link rel="icon" href="assets/images/iskcon-fevicon.png" type="image/gif" />
    <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,300i,400,400i,700i" rel="stylesheet">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
    <script src="assets/booklet/jquery.easing.1.3.js" type="text/javascript"></script>
    <script src="assets/booklet/jquery.booklet.1.1.0.min.js" type="text/javascript"></script>
    <link href="assets/booklet/jquery.booklet.1.1.0.css" type="text/css" rel="stylesheet" media="screen" />
</head>
<div class="book">
    <div class="button-grid">
        <a href="./indexs.html" class="grid-button">Home</a>
        <style>
            * {
                margin: 0;
                padding: 0;
            }
            .book {
                color: #444;
                font-size: 12px;
                font-family: 'Oswald', sans-serif;
            }
        
            .booklet {
                width: 900px;
                height: 607px;
                position: relative;
                margin: 0 auto 10px;
                box-shadow: 0px 0px 1px #fff;
                border-radius: 10px;
            }
            .book_wrapper {
                margin: 0 auto;
                padding-top: 50px;
                width: 905px;
                height: 540px;
                position: relative;
                background: transparent url(assets/images/bg.png) no-repeat 9px 27px;
            }
            .booklet img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            a#next_page_button,
            a#prev_page_button {
                display: none;
                position: absolute;
                width: 41px;
                height: 40px;
                cursor: pointer;
                margin-top: -20px;
                top: 50%;
                background: transparent url(assets/images/buttons.png) no-repeat 0px -40px;
            }
            a#prev_page_button {
                left: -30px;
            }
            a#next_page_button {
                right: -30px;
                background-position: -41px -40px;
            }
            a#next_page_button:hover {
                background-position: -41px 0px;
            }
            a#prev_page_button:hover {
                background-position: 0px 0px;
            }
        
            /* Mobile landscape styles */
            @media only screen and (max-width: 768px) {
                .booklet {
                    width: 100%;
                    height: auto; /* Adjust height as needed */
                    margin: 0 auto;
                }
                .book_wrapper {
                    width: 100%;
                    height: auto; /* Adjust height as needed */
                    padding-top: 20px; /* Adjust padding if needed */
                }
                #mybook {
                    display: block; /* Ensure the book is visible */
                }
                a#next_page_button,
                a#prev_page_button {
                    display: block; /* Show buttons */
                    width: 30px; /* Adjust button size if needed */
                    height: 30px; /* Adjust button size if needed */
                }
            }
        
            /* New styles for vertical layout in phone mode */
            @media only screen and (max-width: 768px) {
                .book_wrapper {
                    flex-direction: column; /* Stack items vertically */
                    align-items: center; /* Center align items */
                }
                .b-load {
                    display: flex;
                    flex-direction: column; /* Stack images vertically */
                    align-items: center; /* Center align images */
                }
                .b-load div {
                    margin: 10px 0; /* Add space between images */
                }
            }
        
            .button-grid {
                display: flex;
                justify-content: left;
                margin: 20px 0;
                flex-wrap: wrap;
            }
            .grid-button {
                padding: 15px 25px;
                font-size: 16px;
                color: white;
                background-color: #4CAF50;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                transition: background-color 0.3s, transform 0.3s;
                text-decoration: none;
                text-align: center;
            }
            .grid-button:hover {
                background-color: #45a049;
                transform: scale(1.05);
            }
            .grid-button {
                font-family: 'Roboto', sans-serif;
            }
        </style>
    </div>
    <div class="button-grid">
        <li><a href="#" id="totalPoints">Total Points: <span id="pointsDisplay">0</span></a></li>
    </div>
    <div class="book_wrapper">
        <a id="next_page_button"></a>
        <a id="prev_page_button"></a>

        <div id="mybook" style="display:none;">
            <div class="b-load">
                <div>
                    <img src="assets/images/img1.jpg" alt=""/>
                </div>
                <div>
                    <img src="assets/images/2.png" alt=""/>
                </div>
                <div>
                    <img src="assets/images/img3.jpg" alt=""/>
                </div>
                <div>
                    <img src="assets/images/4.png" alt=""/>
                </div>
                <div>
                    <img src="assets/images/img5.jpg" alt=""/>
                </div>
                <div>
                    <img src="assets/images/6.png" alt=""/>
                </div>
                <div>
                    <img src="assets/images/img6.jpg" alt=""/>
                </div>
                <div>
                    <img src="assets/images/8.png" alt=""/>
                </div>
                <div>
                    <img src="assets/images/img2.jpg" alt="">
                </div>
                <div>
                    <img src="assets/images/5.png" alt="">
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(function() {
            var $mybook = $('#mybook');
            var $bttn_next = $('#next_page_button');
            var $bttn_prev = $('#prev_page_button');
            var $mybook_images = $mybook.find('img');
            var cnt_images = $mybook_images.length;
            var loaded = 0;

            $mybook_images.each(function() {
                var $img = $(this);
                var source = $img.attr('src');
                $('<img/>').load(function() {
                    ++loaded;
                    if (loaded === cnt_images) {
                        $bttn_next.show();
                        $bttn_prev.show();
                        $mybook.show().booklet({
                            width: 800,
                            height: 500,
                            speed: 900,
                            direction: 'LTR',
                            next: $bttn_next,
                            prev: $bttn_prev,
                        });
                    }
                }).attr('src', source);
            });
        });
    </script>
</div>


<div class="chat">
    <div class="chat-container">
        <div class="message" id="messageContainer"></div>
        <div class="input-container">
            <input type="text" id="userMessage" placeholder="Type Today's learning..." />
            <button id="submitMessage">Submit</button>
        </div>
    </div>
    <style>
        .chat {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        .chat-container {
            max-width: 600px;
            margin: auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            position: relative;
        }
        .message {
            margin-bottom: 20px;
        }
        .message p {
            background: #e0e0e0;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .input-container {
            display: flex;
            margin-top: 20px;
        }
        .input-container input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .input-container button {
            padding: 10px;
            border: none;
            background: #007bff;
            color: white;
            border-radius: 5px;
            margin-left: 10px;
            cursor: pointer;
        }
        .input-container button:hover {
            background: #0056b3;
        }
    </style>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore.js";

        // Your Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyB1jmMeWclknWulKUJLTu894mY5L3IHexw",
            authDomain: "iskcondeepostava-d89e2.firebaseapp.com",
            projectId: "iskcondeepostava-d89e2",
            storageBucket: "iskcondeepostava-d89e2.appspot.com",
            messagingSenderId: "599506324462",
            appId: "1:599506324462:web:7997c5dde1549d26365cff",
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', () => {
            let userId;

            // Define keywords and their corresponding points
            const keywords = {
                "dharma": 5,
                "karma": 5,
                "bhakti": 5,
                "yoga": 5,
                "moksha": 5,
                "sankhya": 5,
                "atman": 5,
                "brahman": 5,
                "rasa": 5,
                "leela": 5,
                "vishnu": 5,
                "avatar": 5,
                "devotion": 5,
                "self-realization": 5,
                "meditation": 5,
                "surrender": 5,
                "wisdom": 5,
                "purusha": 5,
                "prakriti": 5,
                "detachment": 5,
                "faith": 5,
                "knowledge": 5,
                "love": 5,
                "compassion": 5,
                "truth": 5,
                "samsara": 5,
                "nirvana": 5,
                "satya": 5,
                "seva": 5,
                "ananda": 5,
                "krishna consciousness": 5,
                "divine love": 5,
                "grace": 5,
                "tamas": 5,
                "rajas": 5,
                "sattva": 5,
                "vairagya": 5,
                "shraddha": 5,
                "sadhana": 5,
                "yajna": 5,
                "puja": 5,
                "prasad": 5,
                "brahmacharya": 5,
                "kirtan": 5,
                "sankirtan": 5,
                "vedas": 5,
                "upanishads": 5,
                "mahabharata": 5,
                "gopis": 5,
                "radha": 5,
                "divine play": 5,
                "chaitanya": 5,
                "bhagavata": 5,
                "transcendence": 5,
                "devotional service": 5,
                "cosmic order": 5,
                "surrender to god": 5,
                "rasa lila": 5,
                "acyuta": 5,
                "good": 5,
                "amazing": 5,
                "nice": 5,
                "excellent": 5,
                "wonderful": 5,
                "fantastic": 5,
                "awesome": 5,
                "marvelous": 5,
                "incredible": 5,
                "brilliant": 5,
                "exceptional": 5,
                "fabulous": 5,
                "outstanding": 5,
                "superb": 5,
                "pleasant": 5,
                "delightful": 5,
                "joyful": 5,
                "radiant": 5,
                "exquisite": 5
            };

            // Update the total points display
            function updatePointsDisplay(points) {
                document.getElementById('pointsDisplay').textContent = points;
            }

            // Handle authentication state
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    await loadMessages(); // Load messages after user is authenticated
                    await updatePointsDisplayOnLogin(); // Update points display on login
                } else {
                    window.location.href = "index.html"; // Redirect if not logged in
                }
            });

            const submitButton = document.getElementById('submitMessage');
            const userMessageInput = document.getElementById('userMessage');

            // Function to calculate points based on keywords and word count
            function calculatePoints(message) {
                let totalPoints = 0;
                const words = message.toLowerCase().split(/\W+/); // Split by non-word characters

                words.forEach(word => {
                    totalPoints += 2; // Base points for each word
                    if (keywords[word]) {
                        totalPoints += keywords[word]; // Add keyword points if present
                    }
                });

                return totalPoints;
            }

            // Update points display when the user logs in
            async function updatePointsDisplayOnLogin() {
                const userDocRef = doc(db, 'users', userId);
                const userDoc = await getDoc(userDocRef);
                const currentPoints = userDoc.exists() ? userDoc.data().messagePoints || 0 : 0;
                updatePointsDisplay(currentPoints); // Set initial points display
            }

            // Submit message
            submitButton.addEventListener('click', async () => {
                const userMessage = userMessageInput.value;
                if (userMessage.trim() !== '') {
                    const points = calculatePoints(userMessage);
                    
                    // Store message and update total points in Firestore
                    const userDocRef = doc(db, 'users', userId);
                    const userDoc = await getDoc(userDocRef);
                    const currentPoints = userDoc.exists() ? userDoc.data().messagePoints || 0 : 0;
                    const newTotalPoints = currentPoints + points;

                    await setDoc(userDocRef, {
                        messages: arrayUnion({
                            text: userMessage,
                            createdAt: Date.now(), // Add createdAt for sorting
                        }),
                        messagePoints: newTotalPoints // Update total message points
                    }, { merge: true });
                    
                    displayMessage(userMessage);
                    updatePointsDisplay(newTotalPoints); // Update displayed points
                    userMessageInput.value = ''; // Clear input field
                }
            });

            // Load messages
            async function loadMessages() {
                const userDocRef = doc(db, 'users', userId);
                const userDoc = await getDoc(userDocRef);

                if (userDoc.exists()) {
                    const messages = userDoc.data().messages || [];
                    messages.sort((a, b) => a.createdAt - b.createdAt);
                    messages.forEach(message => {
                        displayMessage(message.text);
                    });
                }
            }

            // Function to display a message
            function displayMessage(message) {
                const newMessage = document.createElement('p');
                newMessage.textContent = message; // Show message without points
                document.getElementById('messageContainer').appendChild(newMessage);
            }
        });
    </script>
</div>

</html>



 <!--disable this page 
<script>
 document.addEventListener('contextmenu', (event) => {
     event.preventDefault();
 });
</script> -->